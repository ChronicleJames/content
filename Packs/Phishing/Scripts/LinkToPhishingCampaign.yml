commonfields:
  id: LinkToPhishingCampaign
  version: 15
vcShouldKeepItemLegacyProdMachine: false
name: LinkToPhishingCampaign
script: |2

  BLACK_COLOR = "color:rgb(64,65,66)"


  incident_id = demisto.incidents()[0].get('id', {})


  server_url = ""
  html = ""


  try:
      context = demisto.executeCommand("getContext", {'id': incident_id})
      campaign_incident_id = demisto.get(context[0], "Contents.context.PartOfCampaign")
      server_url = demisto.executeCommand('GetServerURL',{})[0]["Contents"]
      if campaign_incident_id and campaign_incident_id != "None":
          html = f"""<div style='text-align:center; padding: 40px; font-size:15px; {BLACK_COLOR};'>This incident is part of a <a href="{server_url}/#/Custom/vvoh19d1ue/{campaign_incident_id}">Phishing Campaign #{campaign_incident_id}</a></div>"""
      else:
          html = f"""<div style='text-align:center; padding: 40px; font-size:15px; {BLACK_COLOR};'>This incident is not part of a phishing campaign.</div>"""

  except Exception:
          html = f"""<div style='text-align:center; padding: 40px; font-size:15px; {BLACK_COLOR};'>This incident is part of a phishing campaign (incident #{campaign_incident_id}).</div>"""


  demisto.results({
  'ContentsFormat': formats['html'],
  'Type': entryTypes['note'],
  'Contents': html
  })
type: python
tags:
- dynamic-section
- phishing
- campaign
comment: Links a Phishing incident to its related Phishing Campaign incident.
enabled: true
scripttarget: 0
subtype: python3
pswd: ""
runonce: false
dockerimage: demisto/python3:3.9.5.20070
runas: DBotWeakRole
fromversion: 5.0.0